// File: extensions/rewardspro-widget/assets/rewards-widget.js (Minified)
!function(){'use strict';function e(){document.querySelectorAll('[id^="rewardspro-widget-"]').forEach(e=>{const t=e.dataset.blockId,n=e.dataset.position;new i(e,t,n)})}class i{constructor(e,i,t){this.el=e,this.id=i,this.pos=t,this.min=!1,this.cont=e.querySelector('.rp-content'),this.minBtn=e.querySelector('.rp-minimized'),this.closeBtn=e.querySelector('.rp-close'),this.data=window.RewardsProData?.[i],this.setPos(),this.setup(),this.data?.customerId&&this.fetch(),this.show()}setPos(){this.el.classList.add(`rp-position-${this.pos}`)}setup(){this.closeBtn?.addEventListener('click',()=>this.minimize()),this.minBtn?.addEventListener('click',()=>this.expand())}async fetch(){if(!this.data)return;try{const{customerId:e,shopDomain:i,apiEndpoint:t}=this.data,n=`${t}/membership?shop=${i}`,s=await fetch(n,{method:'GET',headers:{'Content-Type':'application/json','X-Shopify-Customer-Id':e.toString()}});if(!s.ok)return void console.error('Failed:',s.status);const o=await s.json();this.update(o)}catch(e){console.error('Error:',e)}}update(e){const i=this.el.querySelector('.rp-value[data-credit]');i&&(i.textContent=this.fmt(e.storeCredit||0),i.dataset.credit=e.storeCredit||0);const t=this.el.querySelector('.rp-mini-value');t&&(t.textContent=this.fmt(e.storeCredit||0));const n=this.el.querySelector('.rp-tier-name');n&&e.tier&&(n.textContent=`${e.tier.name} (${e.tier.cashbackPercent}% cashback)`)}fmt(e){return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format(e)}show(){this.cont.style.display='block',this.minBtn.style.display='none',this.min=!1}minimize(){this.cont.style.display='none',this.minBtn.style.display='flex',this.min=!0}expand(){this.show()}}window.RewardsWidget=i,'loading'===document.readyState?document.addEventListener('DOMContentLoaded',e):e()}();